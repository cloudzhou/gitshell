{% extends "base.html" %}
{% block css %}
<style>
#id_user_detail dt {text-align: left; font-weight: normal; color: #999999;}
#id_user_detail .dl-horizontal {margin-top: 0px;}
#id_user_resume strong {font-size: 12px; font-weight: 300}
.small_page-header { padding-bottom: 2px; margin-bottom: 10px; }
.more { float:right; font-size: 13px; color: #999999 }
.big_font { font-size: 25px; font-weight: 400 }
.zero_border_table td { border-top: 0px; }
#id_watch_user { font-size: 35px; }
#id_unwatch_user { font-size: 35px; }
</style>
{% endblock %}
{% block container %}
<div class="page-header">
    <div class="row">
        <div class="span1">
            <a href="https://gravatar.com/"><img src="https://gravatar.com/avatar/{{ gsuserprofile.imgurl }}?s=40"/></a>
        </div>
        <div class="span6">
            <div style="margin-bottom: 5px">
                <span class="big_font">{{ gsuser.username }}
                {% if gsuserprofile.nickname %}
                    ({{ gsuserprofile.nickname }})
                {% endif %}
            {% if user.username != gsuser.username %}
                {% if not is_watched_user %}
                    <a id="id_watch_user" href="javascript: void(0)">+</a>
                {% else %}
                    <a id="id_unwatch_user" href="javascript: void(0)">-</a>
                {% endif %}
            {% endif %}
                </span>
                <span id="id_user_alert" class="alert alert-error" style="display: none">
                    <strong>失败!</strong> <span id="id_alert_message"></span>
                </span>
            </div>
            <span class="muted">{{ gsuserprofile.tweet }}</span>
        </div>
        <div class="span">
            {% if user.username == gsuser.username %}
                <a href="/{{ gsuser.username }}/repo/"><span class="big_font">{{ gsuserprofile.pubrepo|add:gsuserprofile.prirepo }}</span></a>
            {% else %}
                <a href="/{{ gsuser.username }}/repo/"><span class="big_font">{{ gsuserprofile.pubrepo }}</span></a>
            {% endif %}
            <br/><span class="muted">仓库</span>
        </div>
        <div class="span">
            <a href="/{{ gsuser.username }}/watch/repo/"><span class="big_font">{{ gsuserprofile.watchrepo }}</span></a>
            <br/><span class="muted">关注仓库</span>
        </div>
        <div class="span">
            <a href="/{{ gsuser.username }}/watch/user/"><span class="big_font">{{ gsuserprofile.watch }}</span></a>
            <br/><span class="muted">关注</span>
        </div>
        <div class="span">
            <a href="/{{ gsuser.username }}/watch/user/"><span class="big_font">{{ gsuserprofile.be_watched }}</span></a>
            <br/><span class="muted">被关注</span>
        </div>
    </div>
</div>
<div class="row">
    <div class="span7">
        <div id="id_user_detail">
            <dl class="dl-horizontal">
                {% if gsuserprofile.website %}
                    <dt>网站</dt>
                    <dd><a href="{{ gsuserprofile.website }}">{{ gsuserprofile.website }}</a></dd>
                {% endif %}
                {% if gsuserprofile.company %}
                    <dt>公司</dt>
                    <dd>{{ gsuserprofile.company }}</dd>
                {% endif %}
                {% if gsuserprofile.location %}
                    <dt>所在地</dt>
                    <dd>{{ gsuserprofile.location }}</dd>
                {% endif %}
                <dt>加入gitshell</dt>
                <dd>{{ gsuserprofile.create_time|date:"Y-m-t" }}</dd>
            </dl>
        </div>
        <div>
            {% block left_sub_container %}{% endblock %}
        </div>
    </div>
    <div class="span5">
        {% block right_sub_container %}{% endblock %}
    </div>
</div>
{% block row_sub_container %}{% endblock %}
{% endblock %}
{% block js %}
<script src="/static/js/moment.min.js"></script>
<script src="/static/js/moment.zh-cn.js"></script>
<script>
$(function(){
    var disabled_watch = false;
    $('#id_watch_user').click(function() {
        if(disabled_watch) {
            return false;
        }
        disabled_watch = true;
        $.ajax({
            url: '/ajax/network/watch/{{ gsuser.username }}/',
            type: 'POST',
            data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
            dataType: 'json',
            timeout: 10000,
            error: function(){
                disabled_watch = false;
                $('#id_user_alert').show();
                $('#id_alert_message').html('网络原因，请求失败，请刷新再次尝试');
            },
            success: function(json){
                if(json.result == 'success') {
                    window.location = window.location
                    return true;
                }
                $('#id_user_alert').show();
                $('#id_alert_message').html(json.message);
            },
        })
    })
    $('#id_unwatch_user').click(function() {
        if(disabled_watch) {
            return false;
        }
        disabled_watch = true;
        $.ajax({
            url: '/ajax/network/unwatch/{{ gsuser.username }}/',
            type: 'POST',
            data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
            dataType: 'json',
            timeout: 10000,
            error: function(){
                disabled_watch = false;
                $('#id_user_alert').show();
                $('#id_alert_message').html('网络原因，请求失败，请刷新再次尝试');
            },
            success: function(json){
                if(json.result == 'success') {
                    window.location = window.location
                    return true;
                }
                $('#id_user_alert').show();
                $('#id_alert_message').html(json.message);
            },
        })
    })
});
</script>
    {% block subjs %}{% endblock %}
{% endblock %}

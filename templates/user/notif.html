{% extends "user/dashboard_base.html" %}

{% block subcontainer %}

{% if notifMessages %}
<div class="notifs bubble">

  {% for notifMessage in notifMessages %}
  <div class="notif-item">

    <div class="notif-type{%if notifMessage.notif_type == 0%} type-commit{%elif notifMessage.notif_type >= 30 and notifMessage.notif_type <= 39 %} type-issue-comment{%elif notifMessage.notif_type == 10 %} type-at{%elif notifMessage.notif_type >= 100 and notifMessage.notif_type <= 105%} type-pull{%elif notifMessage.notif_type == 300%} type-issue{%endif%}">
    </div>

    <div class="summary">
      <time class="unixtime" pubdate="pubdate">{{notifMessage.relative_obj.modify_time|date:"U"}}</time>
      <p>
      <a href="/{{notifMessage.relative_name}}/" class="user">{#<img src="https://gravatar.com/avatar/{{notifMessage.relative_name}}?s=15" alt="{{notifMessage.relative_name}}">#}{{notifMessage.relative_name}}</a>
      {% if notifMessage.relative_obj %}
      {% if notifMessage.notif_type == 0 %}
      <span class="path">在</span>
      {# notif parent #}
      <span class="parent">
      <a href="/{{notifMessage.relative_obj.get_repo_username}}/{{notifMessage.relative_obj.repo_name}}/">{{notifMessage.relative_obj.repo_name}}</a>:<a href="/{{notifMessage.relative_obj.get_repo_username}}/{{notifMessage.relative_obj.repo_name}}/commits/{{notifMessage.relative_obj.get_short_refname}}/">{{notifMessage.relative_obj.get_short_refname}}</a>
      </span>
      <span class="action-type">提交了一个Commit</span>
      {# subject #}
      <a href="#{#此处Commit的连接地址#}" class="notif-title"><span class="subject">{{notifMessage.relative_obj.subject|truncatechars:80}}</span></a>

      {% elif notifMessage.notif_type == 30 %}
      <span class="path">在</span>
      {# notif parent #}
      <a href="/{{notifMessage.relative_obj.username}}/{{notifMessage.relative_obj.reponame}}/" class="parent">{{notifMessage.relative_obj.reponame}}</a>
      <span class="action-type">issue</span>
      {# subject #}
      <a href="/{{notifMessage.relative_obj.username}}/{{notifMessage.relative_obj.reponame}}/issues/{{notifMessage.relative_obj.id}}/" class="notif-title"><span class="id">#{{notifMessage.relative_obj.id}}</span><span class="subject">{{notifMessage.relative_obj.subject|truncatechars:80}}</span></a>

      {% elif notifMessage.notif_type == 31 %}
      <span class="path">在</span>
      {# notif parent #}
      <a href="/{{notifMessage.relative_obj.username}}/{{notifMessage.relative_obj.reponame}}/" class="parent">{{notifMessage.relative_obj.reponame}}</a>
      <span class="action-type">评论了Issue</span>
      {# subject #}
      <a href="/{{notifMessage.relative_obj.username}}/{{notifMessage.relative_obj.reponame}}/issues/{{notifMessage.relative_obj.issue_id}}/" class="notif-title"><span class="id">#{{notifMessage.relative_obj.issue_id}}</span><span class="subject">{{notifMessage.relative_obj.content|truncatechars:80}}</span></a>

      {% elif notifMessage.notif_type == 10 %}
      <span class="action-type">在合并请求中@你:</span>
      {# notif title #}
      <a href="/{{notifMessage.relative_obj.desc_repo.username}}/{{notifMessage.relative_obj.desc_repo.name}}/pull/{{notifMessage.relative_obj.id}}/" class="notif-title"><span class="id">#{{notifMessage.relative_obj.id}}</span><span class="subject">{{notifMessage.relative_obj.short_title|truncatechars:80}}</span></a>

      {% elif notifMessage.notif_type >= 100 and notifMessage.notif_type <= 105 %}
      <span class="action-type">{{notifMessage.message}}合并请求</span>
      {# notif title #}
      <a href="/{{notifMessage.relative_obj.desc_repo.username}}/{{notifMessage.relative_obj.desc_repo.name}}/pull/{{notifMessage.relative_obj.id}}/" class="notif-title"><span class="id">#{{notifMessage.relative_obj.id}}</span><span class="subject">{{notifMessage.relative_obj.short_title|truncatechars:80}}</span></a>

      {% elif notifMessage.notif_type == 300 %}
      <span class="path">在</span>
      {# notif parent #}
      <a href="/{{notifMessage.relative_obj.username}}/{{notifMessage.relative_obj.reponame}}/" class="parent">{{notifMessage.relative_obj.reponame}}</a>
      <span class="action-type">{{notifMessage.message}} issue</span>
      {# issue subject #}
      <a href="/{{notifMessage.relative_obj.username}}/{{notifMessage.relative_obj.reponame}}/issues/{{notifMessage.relative_obj.id}}/" class="notif-title"><span class="id">#{{notifMessage.relative_obj.id}}</span><span class="subject">{{notifMessage.relative_obj.subject|truncatechars:80}}</span></a>
      {% endif %}
      {% endif %}
      </p>
    </div>
  </div>

  {% endfor %}

  {% else %}
  <div class="notif-item">
    <p class="info">没有消息</p>
  </div>
  {% endif %}

</div>

{% endblock %}

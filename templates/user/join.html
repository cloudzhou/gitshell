{% extends "base.html" %}
{% block container %}
<style>
.command { padding: 5px; margin-left: 20px; margin-bottom: 5px; font-size: 16px }
</style>
{% ifequal step '3'  %}
<div class="page-header">
        <h1>:-), {{ user.username }}，欢迎您</h1>
</div>
{% else %}
<div class="page-header">
        <h1>:-), 注册 <small>已经拥有帐号？直接<a href="/login/">登录</a></small></h1>
</div>
{% endifequal %}
<div class="row">
{% ifequal step '0' %}
    <div class="span9">
        <form class="well form-inline" action="/join/0/" method="post">
            {% csrf_token %}
            {{ joinForm0.email }}
            &nbsp;·&nbsp;
            {{ joinForm0.captcha }}
            <button class="btn" type="submit">注册</button>
        </form>
        {% if error %}
        <div class="alert">
            <a data-dismiss="alert" class="close">×</a>
            <strong>出错了！</strong> {{ error }}
        </div>
        {% endif %}
    </div>
{% endifequal %}
{% ifequal step '1' %}
    <div class="span12">
    <p class="lead">谢谢你，已经发送注册邮件，请在半小时内激活，注意查收</p>
    <p class="lead">（部分运营商会拦截邮件，您有可能需要查看一下垃圾邮件）</p>
    <small>如果发送邮件失败，请联系<a href="mailto:support@gitshell.com">support@gitshell.com</a> 或者 <a target="_blank" href="http://weibo.com/gitshell"><img src="/static/img/sina_logo.png"/>&nbsp;gitshell</a></small>
    </div>
{% endifequal %}
{% if step|length > 1 %}
    <div class="span7">
        <form class="form-horizontal" action="" method="post">
            {% csrf_token %}
            <fieldset>
                <div class="control-group">
                    <label for="id_name" class="control-label">用户名</label>
                    <div class="controls">
                        {{ joinForm1.name }}
                        <span class="help-inline">注册后不可修改, 最长12字符</span>
                    </div>
                </div>
                <div class="control-group">
                    <label for="id_password" class="control-label">密码</label>
                    <div class="controls">
                        {{ joinForm1.password }}
                    </div>
                </div>
                {% if error %}
                <div class="alert">
                    <a data-dismiss="alert" class="close">×</a>
                    <strong>出错了！</strong> {{ error }}
                </div>
                {% endif %}
                <div class="form-actions">
                    <button id="id_join_submit" class="btn btn-primary" type="submit">注册</button>
                </div>
            </fieldset>
        </form>
    </div>
{% endif %}
{% ifequal step '3' %}
    <div class="span12">
    <p class="lead">为了gitshell能更好的为您服务，你有必要看一下：</p>
    <p>快速入门：</p>
    <p style="margin-left: 10px">如果您使用任何类unix系统，第一次配置 ssh 公钥密钥，请按照步骤，复制黑色背景字符，在终端执行命令，和编辑文件</p>
    <p style="margin-left: 20px">1) 执行以下命令，生成 ssh 密钥, 保存在 ~/.ssh/gitshell.com_rsa</p>
        <textarea rows="1" cols="100" style="width: 500px; margin-left: 20px;" class="pull-left shell span4 command">
ssh-keygen -t rsa  -N '' -f ~/.ssh/gitshell.com_rsa;
        </textarea>
    <p style="margin-left: 20px">2) 编辑 ssh 客户端配置文件 ~/.ssh/config，使用您熟悉的编辑器，在后面添加</p>
        <textarea rows="4" cols="100" style="width: 500px; margin-left: 20px;" class="pull-left shell span4 command">
Host gitshell.com
 User {{ user.username }}
 IdentityFile ~/.ssh/gitshell.com_rsa
 PreferredAuthentications publickey
</textarea>
    <p style="margin-left: 20px">3) 查看 ssh 公钥，使用 cat 命令，或者用编辑器打开</p>
        <textarea rows="1" cols="100" style="width: 500px; margin-left: 20px;" class="pull-left shell span4 command">
cat ~/.ssh/gitshell.com_rsa.pub
        </textarea>
    <p style="margin-left: 20px">4) 请复制 ssh 公钥的文本内容，点击<a target="_blank" href="/settings/sshpubkey/">ssh public key 管理</a>，输入标识保存公钥</p>
    <p style="margin-left: 20px">5) ssh 公钥配置之后就可以长期使用了，请保护好 ~/.ssh/gitshell.com_rsa 密钥。点击<a target="_blank" href="/{{ user.username }}/repo/edit/0/">创建仓库</a>，详细仓库说明有助于推广</p>
    <p style="margin-left: 20px">6) 你已经可以使用 gitshell 来托管代码了，以下是示范的操作，详细信息请<a href="/help/#learn">开始git的学习</a></p>
        <textarea rows="7" cols="100" style="width: 500px; margin-left: 20px;" class="pull-left shell span4 command">
&gt; git clone git@gitshell.com:your_name/repo_name
&gt; cd repo_name;
&gt; vim README.md
&gt; git add README.md
&gt; git commit -m "init README.md" .
&gt; git push -u origin master
        </textarea>
    <p style="margin-left: 20px">7) 感谢您走完整个配置流程，如果遇到任何问题，直接联系 support@gitshell.com，或者官方微博 <a target="_blank" href="http://weibo.com/gitshell">http://weibo.com/gitshell</a></p>
    </div>
    <div class="span12">
        <p>更多帮助：</p>
        <ul>
            <li><a href="/help/#sshkey">设置ssh pub key</a></li>
            <li><a href="/help/#repo">创建仓库</a></li>
            <li><a href="/help/#group">协同开发</a></li>
            <li><a href="/help/#faq">gitshell 能做什么？</a></li>
            <li><a href="/help/#faq">gitshell 不能做什么？</a></li>
        </ul>
    </div>
{% endifequal %}
{% ifequal step '4' %}
    <div class="span12">
    <small>注册失败，可能是激活url Token过期，请重新通过<a href="/join/0/">注册</a>获取激活url，如果这种情况持续出现，请联系<a href="mailto:support@gitshell.com">support@gitshell.com</a> 或者 <a target="_blank" href="http://weibo.com/gitshell"><img src="/static/img/sina_logo.png"/>&nbsp;gitshell</a></small>
    </div>
{% endifequal %}
</div>
{% endblock %}
{% block js %}
<script src="/static/js/md5.min.js"></script>
<script>
/*global jQuery, window */
$(function(){
    var md5_user_passwd = function() {
        $('#id_password').val(window.md5($('#id_password').val()));
    },
    join0_init = function() {
        $('#id_email').attr('placeholder', '输入邮箱');
        $('#id_captcha_1').attr('placeholder', '输入验证码');
    };
    join1_init = function() {
        $('#id_name').attr('placeholder', '用户名，[A-Za-z0-9_]');
        $('#id_password').attr('placeholder', '密码，包含数字和字母');
    };
{% ifequal step '0' %}
    join0_init();
{% endifequal %}
{% if step|length > 1 %}
    join1_init();
{% endif %}
    $('#id_join_submit').on('click', md5_user_passwd);
});
</script>
{% endblock %}

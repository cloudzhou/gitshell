{% extends "team/dashboard_base.html" %}

{% block subcontainer %}

  <div class="pulls bubble">
    <div class="header">
      <h2 class="heading">需要我处理的</h2>
      <span class="sortable btn-group">
        <a id="pullMerge" href="/{{teamUser.username}}/-/dashboard/pull/merge/" class="btn btn-mini btn-disable first">需要我处理的</a>
        <a id="pullRequest"href="/{{teamUser.username}}/-/dashboard/pull/request/" class="btn btn-mini last">我创建的</a>
      </span>
    </div>

    {% if pullRequests %}
      {% for pullRequest in pullRequests %}
        <section class="pull-item">
          <div class="pull">

            <figure class="avatar">
              <img src="https://gravatar.com/avatar/{{pullRequest.pull_user.username}}?s=38" alt="{{pullRequest.pull_user.username}}">
            </figure>

            <div class="info">

              <h3 class="heading">
                <a href="/{{pullRequest.desc_repo.username}}/{{pullRequest.desc_repo.name}}/pull/{{pullRequest.id}}/" class="id">{#[{{pullRequest.id}}]#}{{pullRequest.short_title}}</a>
                <span class="label label-mini {{pullRequest.status_label}}">{{pullRequest.status_view}}</span>
              </h3>

              <div class="branches hide">
                <span class="puller">
                  <a href="/{{pullRequest.pull_user.username}}/">{{pullRequest.pull_user.username}}</a>想把
                </span>
                <span class="sub">{#<a href="/{{pullRequest.source_repo.username}}/">{{pullRequest.source_repo.username}}</a>/#}<a href="/{{pullRequest.source_repo.username}}/{{pullRequest.source_repo.name}}/">{{pullRequest.source_repo.name}}</a>:<span{# href="/{{pullRequest.source_repo.username}}/{{pullRequest.source_repo.name}}/tree/{{pullRequest.source_refname}}/" #} class="repo-name">{{pullRequest.source_refname}}</span>
                </span>合并到
                <span class="master">{#<a href="/{{pullRequest.desc_repo.username}}/">{{pullRequest.desc_repo.username}}</a>/#}<a href="/{{pullRequest.desc_repo.username}}/{{pullRequest.desc_repo.name}}/">{{pullRequest.desc_repo.name}}</a>:<span{# href="/{{pullRequest.desc_repo.username}}/{{pullRequest.desc_repo.name}}/tree/{{pullRequest.desc_refname}}/" #} class="repo-name">{{pullRequest.desc_refname}}</span>
                </span>
              </div>
              <p class="desc">{{pullRequest.short_desc}}</p>
          </div>

          </div>
        </section>
      {% endfor %}
    {% else %}
      <div class="pull-item wall">
        <p>没有合并请求需要处理。</p>
      </div>
    {% endif %}

  </div>


{% endblock %}

{% block js %}
  <script>
    $(function(){
        moment.lang('zh-cn');
        $('#pullMerge').click(function(){
            window.location.href = '/dashboard/pull/';
        });
        $('#pullRequest').click(function(){
            window.location.href = '/dashboard/pull/request/';
        });
    });
  </script>
{% endblock %}

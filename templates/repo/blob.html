{% extends "repo/repo.html" %}

{% block css %}
<link rel="stylesheet" title="default" href="/static/less/app/highlight/default.css" disabled="disabled">
<link rel="stylesheet" title="IDEA" href="/static/less/app/highlight/idea.css" disabled="disabled">
<link rel="stylesheet" title="sunburst" href="/static/less/app/highlight/sunburst.css" disabled="disabled">
<link rel="stylesheet" title="github" href="/static/less/app/highlight/github.css">
<link rel="stylesheet" title="googleCode" href="/static/less/app/highlight/googlecode.css" disabled="disabled">
<link rel="stylesheet" title="solarized" href="/static/less/app/highlight/solarized_dark.css" disabled="disabled">
<link rel="stylesheet" title="xCode" href="/static/less/app/highlight/xcode.css" disabled="disabled">
<link rel="stylesheet" title="tomorrowNightBright" href="/static/less/app/highlight/tomorrow-night-bright.css" disabled="disabled">
<link rel="stylesheet" title="pojoaque" href="/static/less/app/highlight/pojoaque.css" disabled="disabled">
<link rel="stylesheet" title="railscasts" href="/static/less/app/highlight/railscasts.css" disabled="disabled">
<style>
  #themes li {
    cursor: pointer;
  }
</style>
{% endblock %}
{% block subcontainer %}
<div class="file-list">
  <div class="header">
    {% include "repo/branch_nav.html" %}
    <span class="actions">
      <a class="btn btn-mini" href="/{{user_name}}/{{repo_name}}/commits/{{refs}}/{{path}}">Commits</a>
      <a class="btn btn-mini" href="/{{user_name}}/{{repo_name}}/raw/blob/{{refs}}/{{path}}">Raw</a>
    </span>
    <ul id="themes">
      <li id="default">Default</li>
      <li id="github">Github</li>
      <li id="sunburst">Sunburst</li>
      <li id="solarized">Solarized</li>
      <li id="googleCode">Google Code</li>
      <li id="xCode">xCode</li>
      <li id="tomorrowNightBright">Tomorrow</li>
      <li id="pojoaque">Pojoaque</li>
      <li id="railscasts">Railscasts</li>
    </ul>
  </div>
  <div id="i_source_code">
    {% if not blob and blob != '' %}
    没有源代码、二进制文件，或者没有查看源代码权限，半公开和私有项目需要申请成为成员才能查看源代码
    {% else %}
    {% if is_markdown %}
    <div id="id_markdown_content" class="markdown hide">{{ blob }}</div>
    {% else %}
    <div class="code bubble">
      <pre><code class="lineNumbers">{{ blob }}</code></pre>
    </div>
    {% endif %}
    {% endif %}
  </div>          
</div>
{% endblock %}
{% block subjs %}
{#<script src="/static/js/app/highlight/highlight.min.js?timestamp={{gitshell.timestamp}}"></script>#}
<script src="/static/js/app/highlight/highlight.pack.js"></script>
<script src="/static/js/jquery.cookie.js"></script>
{% if is_markdown %}
<script src="/static/js/app/markdown/marked.js"></script>
<script src="/static/js/app/caja/html-css-sanitizer-minified.js"></script>
{% endif %}
<script>
  $(function(){
    set_path_href = function() {
      var base_href_path = '/{{user_name}}/{{repo_name}}/tree/{{refs}}/';
      var path = '{{path}}';
      if(path == '.') {
        return;
      }
      var paths = path.split('/');
      path_href_html = '';
      for(x in paths) {
        subpath = paths[x];
        if(subpath == '') {
          break;
        }
        base_href_path = (base_href_path + subpath + '/');
        if(path.substr(-1) === "/") {
          if(x != (paths.length-2)) {
            path_href_html = (path_href_html + ' <a href="' + base_href_path + '">' + subpath + '</a> /');
          } else {
            path_href_html = (path_href_html + ' ' + subpath + ' /');
          }
        } else {
          if(x != (paths.length-1)) {
            path_href_html = (path_href_html + ' <a href="' + base_href_path + '">' + subpath + '</a> /');
          } else {
            path_href_html = (path_href_html + ' ' + subpath);
          }
        }
      }
      $('#repo-path').html(path_href_html);
    };
    set_path_href();
    {% if is_markdown %}
    marked.setOptions({ gfm: true, tables: true, breaks: false, pedantic: false, sanitize: false, smartLists: true, smartypants: false, langPrefix: 'lang-' });
    var html = $('#id_markdown_content').html();
    html = $('<div/>').html(html).text();
    var sanitized_html = html_sanitize(marked(html), function(url) { return url; }, function(id) { return id; })
      $('#id_markdown_content').html(sanitized_html);
    $('#id_markdown_content').show();
    {% else %}
    //hljs.tabReplace = '    ';
    hljs.initHighlightingOnLoad();
    {% endif %}
  });
</script>
<script>
  $(function(){

    var colorSchemeCookie = $.cookie("colorscheme");

    if(colorSchemeCookie == null){
      $("link[title='github']").removeAttr("disabled");
      $("#themes #github").addClass("current");
    } else {
      $("link[title='" + colorSchemeCookie + "']").removeAttr("disabled");
      $("#themes li[id='" + colorSchemeCookie + "']").addClass("current");
      $("link[title!='" + colorSchemeCookie + "']").attr("disabled","disabled");
    }

    $("#themes li").click(function(){
      var colorScheme = $(this).attr("id");
      $("link[title='" + colorScheme + "']").removeAttr("disabled");
      $("link[title!='" + colorScheme +"']").attr("disabled","disabled");
      $.cookie("colorscheme", colorScheme , {expires:30});
      $(this).addClass("current").siblings().removeClass("current");
    });

  });
</script>
{% endblock %}

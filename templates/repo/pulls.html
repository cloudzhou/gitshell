{% extends "repo/repo.html" %}

{% block subcontainer %}

<div class="bubble repo">
	<header class="bubble-header">
		<h2 class="title"><i class="icon-code-fork"></i>Pull Requests</h2>
	</header>
	<section class="bubble-inner">
		<table class="table">
			<colgroup>
				<col width="16%">
				<col width="15%">
				<col width="49%">
				<col width="10%">
				<col width="10%">
			</colgroup>
			<tbody>
				{% if pullRequests %}
					{% for pullRequest in pullRequests %}
						<tr>
							<td class="title">
								<a href="/{{user_name}}/{{repo_name}}/pull/{{pullRequest.id}}/">#{{pullRequest.id}} {{pullRequest.short_title}}</a>
							</td>
							<td class="puller">
								<a class="muted" href="/{{pullRequest.pull_user.username}}/"><span class="avatar"><img src="https://gravatar.com/avatar/{{watch_user.imgurl}}?s=16" alt="{{ gsuser.username }}"></span>@{{pullRequest.pull_user.username}}</a>
							</td>
							<td class="branch">
								<span class="master">
									<i class="icon-circle-blank"></i>
									<span><a href="/{{pullRequest.desc_repo.username}}/{{pullRequest.desc_repo.name}}/">{{pullRequest.desc_repo.name}}</a>:<a href="/{{pullRequest.desc_repo.username}}/{{pullRequest.desc_repo.name}}/tree/{{pullRequest.desc_refname}}/">{{pullRequest.desc_refname}}</a></span>
								</span>
								<span class="sub-branch">
									<i class="icon-circle-blank"></i>
									<span><a href="/{{pullRequest.source_repo.username}}/{{pullRequest.source_repo.name}}/">{{pullRequest.source_repo.name}}</a>:<a href="/{{pullRequest.source_repo.username}}/{{pullRequest.source_repo.name}}/tree/{{pullRequest.source_refname}}/">{{pullRequest.source_refname}}</a></span>
								</span>
							</td>
							<td class="description">{{pullRequest.short_desc}}</td>
							<td class="status"><span class="label label-info {{pullRequest.status_label}}">{{pullRequest.status_view}}</span></td>
						</tr>
					{% endfor %}
				{% else %}
					<tr>
						<td colspan="5"><p class="info text-error"><i class="icon-bell"></i>当前仓库还没有 Pull Request。<a href="/{{ user_name }}/{{ repo_name }}/pull/new/" class="btn btn-success"><i class="octicon octicon-git-pull-request"></i>合并请求</a></p></td>
					</tr>
			{% endif %}
			</tbody>
		</table>
	</section>
</div>

{% endblock %}

{% block subjs %}
	<script>
	$(function(){
		$('.c_unixtime').each(function(index){ 
			$(this).html(moment(new Date($(this).html()*1000)).fromNow());
			$(this).show();
		});
	});
	</script>
{% endblock %}

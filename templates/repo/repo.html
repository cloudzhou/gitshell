{% extends "base.html" %}
{% block css %}
{% if current == 'index' or current == 'tree' or current == 'commits' %}
<link href='/static/css/app/syntaxhighlighter/shCore.css' rel='stylesheet' type='text/css' />
<link href='/static/css/app/syntaxhighlighter/shThemeDefault.css' rel='stylesheet' type='text/css' />
{% endif %}
{% endblock %}
{% block container %}
<div class="code">
    <div class="page-header" style="padding-bottom: 0px; margin-top: 0px;">
	    <ul class="breadcrumb" style="margin-bottom: 0px">
            <li style="margin-right: 5px">
            {% if repo.auth_type == 0 %}
                <img src="/static/img/glyphicons_203_lock.png"/>
            {% else %}
                <img src="/static/img/glyphicons_204_unlock.png"/>
            {% endif %}
            </li>
            <li><h4><a href="/{{ user_name }}/">{{ user_name }}</a> <span class="divider">/</span></h4></li>
            <li><h4><a href="/{{ user_name }}/{{ repo_name }}/">{{ repo_name }}</a></h4></li>
            <li class="pull-right">
                <span style="margin-right: 5px">
                    <a href=""><img src="/static/img/glyphicons_051_eye_open.png"/></a>
                    <a style="font-size: 15px" href="/{{ user_name }}/{{ repo_name }}/clone_watch/">{{repo.watch}}</a>
                </span>
                <span style="margin-right: 5px">
                    <a href=""><img src="/static/img/glyphicons_114_list.png"/></a>
                    <a style="font-size: 15px" href="/{{ user_name }}/{{ repo_name }}/clone_watch/">{{repo.fork}}</a>
                </span>
            </li>
        </ul>
        {% if current == 'index' %}
        <div class="breadcrumb" style="border-top: 0px; padding: 8px;">
    	    <div class="row">
    			<div class="span9">
    			    <p>{{repo.desc}} — <a href="#README.md">更多介绍</a></p>
    			</div>
    		</div>
    		<div class="row">
    			<div class="span1">
    				<button href="#" class="btn btn-small"><i class="icon-download"></i> ZIP</button>
    			</div>
    			<div class="pull-left" style="margin-left: 30px">
    				<div data-toggle="buttons-radio" class="btn-group">
                        <button class="btn active">HTTP</button>
                        <button class="btn">SSH</button>
                    </div>				
                </div>				
    			<div class="pull-left">
    				<input id="i_git_url" style="margin-bottom: 0px;" type="text" value="http://gitshell.com/{{ user_name }}/{{ repo_name }}.git" class="span5">
    				<i class="icon-list-alt"></i> 只读
    			</div>
    		</div>
		</div>
        {% endif %}
	</div>

	<div class="row">
	    <div id="repo_nav" class="span12">
	        <ul class="nav nav-tabs">
                <li id="i_refs" class="dropdown">
                    <a href="javascript:void" data-toggle="dropdown" class="dropdown-toggle">分支&标签<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    </ul>
                </li>
                <li {% if current == 'tree' or current == 'index' %} class="active" {% endif %}><a href="/{{ user_name }}/{{ repo_name }}/tree/{{ refs }}/">文件列表</a></li>
                <li {% if current == 'commits' %} class="active" {% endif %}><a href="/{{ user_name }}/{{ repo_name }}/commits/{{ refs }}/">提交信息</a></li>
                <li {% if current == 'issues' %} class="active" {% endif %}><a href="/{{ user_name }}/{{ repo_name }}/issues/">Issues</a></li>
                <li {% if current == 'network' %} class="active" {% endif %}><a href="/{{ user_name }}/{{ repo_name }}/network/">协同</a></li>
                <li {% if current == 'branches' %} class="active" {% endif %}><a href="/{{ user_name }}/{{ repo_name }}/clone_watch/">衍生&amp;关注</a></li>
                <li {% if current == 'stats' %} class="active" {% endif %}><a href="/{{ user_name }}/{{ repo_name }}/stats/">统计</a></li>
            </ul>
    {% block subcontainer %}{% endblock %}
		</div>
	</div>
</div>
{% endblock %}
{% block js %}
<script src="/static/js/moment.min.js"></script>
<script src="/static/js/moment.zh-cn.js"></script>
<script>
/*global jQuery, window */
$(function(){
    moment.lang('zh-cn');
    $('#i_git_url').click(function(event) {
        $('#i_git_url').select();
    });
    var do_refs = function() {
        $.ajax({
            url: '/ajax/repo/{{user_name}}/{{repo_name}}/refs/',
            type: 'POST',
            data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
            dataType: 'json',
            timeout: 5000,
            error: function(){
                //alert('');
            },
            success: function(json){
                if($('#i_refs .dropdown-menu li').size() > 0) {
                    return;
                }
                for(x in json.branches) {
                    $('#i_refs .dropdown-menu').append('<li><a href="/{{user_name}}/{{repo_name}}/tree/' + json.branches[x] + '/">' + json.branches[x] + '</a></li>');
                } 
                if(json.tags.length > 0) {
                    $('#i_refs .dropdown-menu').append('<li class="divider"></li>');
                }
                for(x in json.tags) {
                    $('#i_refs .dropdown-menu').append('<li><a href="/{{user_name}}/{{repo_name}}/tree/' + json.tags[x] + '/">' + json.tags[x] + '</a></li>');
                } 
            },
        })
    }
    $('#i_refs').mouseover(function(event) {
        if($('#i_refs .dropdown-menu li').size() == 0) {
            do_refs();
        }
    });
});
</script>
{% block subjs %}{% endblock %}
{% endblock %}
